<include file="App/Home/View/Public/header.html"/>

<style>
    .passContent .tagContent .ybc_con li label{
        float:inherit;
        padding-left: 10px;
    }
    .error{
        color: red;
    }
	.tishi1{ background-color:#FDF2DB; width:400px;}
	.tishi1 span.tishi_text{ color:#ccc; padding-left:40px; }
</style>

<script>
    $(document).ready(function(){
        start=document.cookie.indexOf("motip=")
        if (start!=-1){
            start=start + 6
            end=start + 1
            motip = unescape(document.cookie.substring(start,end))
            if(motip == 1)
                $('#phone_top_div').show();
        }
    });

    function hidephone(){
        $('#phone_top_div').hide();
        var d=new Date()
        d.setTime(d.getTime() + 7200)
        document.cookie="motip=2;expires="+d.toUTCString()
    }
</script>

<script src="js/index.js"></script>
    <div id="main">
        <div class="main_box">
            <include file="App/Home/View/Public/left.html"/>
            <div class="raise right clearfix">
            <link rel="stylesheet" href="__PUBLIC__/Home/css/layer.css">
            <h2>修改密码</h2>
            <div class="support_ybc pass_ybc">
            <ul id="pass_change">
                <li class=""><a onclick="selectTag('tagContent0',this)" id="uppass" href="javascript:void(0)">修改密码</a> </li>
                <li class="selectTag"><a onclick="selectTag('tagContent1',this)" id="uptrade" href="javascript:void(0)">修改交易密码</a></li>
                <div class="clear"></div>
            </ul>

			<script type="text/javascript">
				$(document).ready(function(){
					var getc = "{$Think.get.type}";
					if(getc == '2'){
						$('#uptrade').click();
					}else{
						$('#uppass').click();
					}
				})				
		    </script>

            <div id="tagContent" class="passContent">
                <div class="tagContent selectTag" id="tagContent0" style="display: none;">
                    <form method="post" id="signupForm"  jump-url="{:U('Login/index')}"   action="{:U('User/updatePassword')}">
                        <ul class="ybc_con"  style="margin-left: 250px;">
                            <li class="tishi1"><span class="tishi_text">您正在为账户&nbsp;<span style="color:red">{$Think.session.USER_KEY}</span>&nbsp;修改登录密码</span></li>
                            <li><label for="password">登录密码：</label><input name="oldpwd" id="oldpwd" type="password" placeholder="请输入原登陆密码"></li>
                            <li><label for="newword">新密码：&nbsp;&nbsp;&nbsp;</label><input name="pwd" id="pwd" type="password" placeholder="请输入新的密码"></li>
                            <li><label for="repeat">重复密码：</label><input name="repwd" id="repwd" type="password" placeholder="两次密码必须保持一致"></li>
                            <li><label class="buys">&nbsp;</label><input class="tijiao" value="提交"  type="submit"></li>
                        </ul>
                    </form>
                </div>

            <div class="tagContent" id="tagContent1" style="display: block;">
                <script>
                    $("#signupForm").validate({
                        rules: {
                            oldpwd:{required: true,rangelength:[6,20]},
                            pwd:{required: true,rangelength:[6,20]},
                            repwd:{rangelength:[6,20],equalTo: "#pwd"}
                        },
                        messages: {
                            oldpwd:{required: "密码不能为空",rangelength:"密码长度在6-20个字符之间"},
                            pwd:{required: "新交易密码不能为空",rangelength:"密码长度在6-20个字符之间"},
                            repwd:{rangelength:"密码长度在6-20个字符之间",equalTo: "两次输入不一样"}
                        },
                        submitHandler:function(form){
                            ajax_submit_form(form)
                            return false;
                        },
                        invalidHandler: function() {  //不通过回调
                            return false;
                        }
                    });
                </script>

                        <form method="post" id="PwdtradeForm" jump-url="{:U('Login/index')}"  enctype="multipart/form-data" action="{:U('User/updatePwdtrade')}">
                            <ul class="ybc_con" style=" margin-left:250px;">
                                <li class="tishi1"><span class="tishi_text">您正在为账户&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:red">{$Think.session.USER_KEY}</span>&nbsp;修改交易密码，并却确认手机号码已绑定</span></li>
                                <li><label for="password">登录密码：&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label><input name="oldpwd_b" type="password" placeholder="请输入登陆密码"></li>
                                <li><label for="newword">新交易密码：&nbsp;&nbsp;&nbsp;</label><input name="pwdtrade" id="pwdtrade" type="password" placeholder="只能包含数字、字母、下划线"></li>
                                <li><label for="repeat">重复交易密码：</label><input name="repwdtrade"  type="password" placeholder="两次输入必须报保持一致"></li>
                                <li>
									<label for="code" style='width:84px;float:left;' >短信验证：&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label><input style='width:160px;float:left;' name="code" id="code" autocomplete="off" type="text"> 
								
								
									<input value="点击发送" style='width:160px;margin-left:5px;float:left;background-color:#f80;cursor:pointer;' type="button" id="msgt" data-key='off' onclick="sandPhone()">
                                </li>                              
								<li></li>
                                <li ><label class="buys">&nbsp;</label><input  style='margin-top:60px;' class="tijiao" value="提交" type="submit"></li>
                            </ul>
                        </form>
                    </div>
                </div>
            </div>

    <script>
        $("#PwdtradeForm").validate({
            rules: {
                oldpwd_b:{required: true,rangelength:[6,20]},
                oldpwdtrade_b:{required: true,rangelength:[6,20]},
                pwdtrade:{required: true,rangelength:[6,20]},
                repwdtrade:{rangelength:[6,20],equalTo: "#pwdtrade"}
            },
            messages: {
                oldpwd_b:{required: "登录密码不能为空",
                          rangelength:"登录密码长度在6-20个字符之间"
                          },
                oldpwdtrade_b:{required: "密码不能为空",rangelength:"交易密码长度在6-20个字符之间"},
                pwdtrade:{required: "密码不能为空",

                          rangelength:"新交易密码长度在6-20个字符之间"},
                repwdtrade:{rangelength:"新交易密码长度在6-20个字符之间",equalTo: "两次输入不一样"}
            },
            submitHandler:function(form){
                if(!$("#code").val()){
                    layer.msg("请填写验证码");
                    return false;
                }
                ajax_submit_form(form)
                return false;
            },
            invalidHandler: function() {  //不通过回调
                return false;
            }
        });
				  
		function sandPhone(){
            var phone="{$member.phone}";		
    		var i=120;
            var tid2;
            tid2=setInterval(function(){
                if($("#msgt").attr("data-key")=='off'){
                    $("#msgt").attr("disabled",true);
                    $("#msgt").removeClass("class");
                    $("#msgt").addClass("button again");
                    i--;
                    $("#msgt").val(i+"秒后可重新发送");
                    if(i<=0){
                        $("#msgt").removeAttr("disabled").val("重新发送验证码");
                        $("#msgt").attr("data-key","on");
                    }
                }
        },1000);
        
        $.post("{:U('Common/ajaxSandPhone')}",{'phone':phone},
            function(d){
                layer.msg(d.info);
                    if(d.status==1){
                        i=120;
                        $("#msgt").attr("data-key","off");
            	}
            });
        }
    </script>

                <script type="text/javascript" src="__PUBLIC__/Home/js/tab2.js"></script>
                <script src="__PUBLIC__/Home/js/layer.js"></script>
                <script src="__PUBLIC__/Home/js/password.js"></script>
                <script type="text/javascript" src="__PUBLIC__/Home/js/ajaxfileupload.js"></script>
            </div>
        <div class="clear"></div>
    </div>
</div>
                <script type="text/javascript" src="__PUBLIC__/js/uploadify/jquery.uploadify.min.js"></script>
                <script type="text/javascript" src="__PUBLIC__/Home/js/tab2.js"></script>
                <script src="__PUBLIC__/Home/js/layer.js"></script>
                <script src="__PUBLIC__/Home/js/password.js"></script>
                <script type="text/javascript" src="__PUBLIC__/Home/js/ajaxfileupload.js"></script>
		    </div>
		<div class="clear"></div>
	</div>
</div>

<script>
    $(".menu8").addClass("uc-current");
</script>

<include file="App/Home/View/Public/footer.html"/>